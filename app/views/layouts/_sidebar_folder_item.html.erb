<%# Set depth for indentation, default to 0 for root folders %>
<% depth ||= 0 %>

<div data-folder-tree-target="folder" data-folder-id="<%= folder.id %>">
  <div class="flex items-center group" style="padding-left: <%= depth * 12 %>px;">
    <% if folder.has_children? %>
      <button
        type="button"
        data-folder-tree-target="toggle"
        data-folder-id="<%= folder.id %>"
        data-action="click->folder-tree#toggle"
        class="w-6 h-6 flex items-center justify-center text-neutral-400 hover:text-neutral-600 transition-colors flex-shrink-0 -ml-1">
        <%= render "shared/svg/chevron_right" %>
      </button>
    <% else %>
      <span class="w-5 flex-shrink-0"></span>
    <% end %>

    <%= link_to notes_path(folder_id: folder.id),
        class: "flex items-center flex-1 px-3 py-2 text-sm rounded-md transition-colors min-w-0 #{'bg-primary-100 text-primary-700' if params[:folder_id]&.to_i == folder.id} #{'text-neutral-600 hover:text-neutral-900 hover:bg-neutral-100' if params[:folder_id]&.to_i != folder.id}" do %>
      <%= render "shared/svg/folder" %>
      <span class="flex-1 truncate"><%= folder.name %></span>
      <span class="ml-auto text-xs bg-neutral-200 text-neutral-700 px-2 py-0.5 rounded-full flex-shrink-0">
        <%= folder.notes.count %>
      </span>
    <% end %>
  </div>

  <% if folder.has_children? %>
    <div data-folder-tree-target="children" class="mt-1">
      <% folder.children.order(:name).each do |child_folder| %>
        <%= render 'layouts/sidebar_folder_item', folder: child_folder, depth: depth + 1 %>
      <% end %>
    </div>
  <% end %>
</div>
